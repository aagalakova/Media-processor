<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaProcessor | Relation-AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .upload-zone {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            margin: 30px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #2980b9;
            background: #e3f2fd;
        }

        .upload-zone.dragover {
            border-color: #27ae60;
            background: #d4edda;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #3498db;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 5px;
        }

        .upload-btn:hover {
            background: #2980b9;
        }

        .file-list {
            margin: 20px 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .file-list-header h3 {
            color: #2c3e50;
        }

        .clear-all-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .clear-all-btn:hover {
            background: #c0392b;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .file-icon {
            font-size: 1.5em;
        }

        .file-size {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .file-rename {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 15px;
        }

        .rename-input {
            padding: 8px 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 0.9em;
            width: 200px;
            transition: border-color 0.3s ease;
        }

        .rename-input:focus {
            border-color: #3498db;
            outline: none;
        }

        .settings {
            background: #f8f9fa;
            padding: 30px;
            margin: 20px 30px;
            border-radius: 15px;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
        }

        .settings-header h2 {
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-controls {
            display: flex;
            gap: 10px;
        }

        .settings-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .settings-btn:hover {
            background: #7f8c8d;
        }

        .settings-btn.reset {
            background: #e67e22;
        }

        .settings-btn.reset:hover {
            background: #d35400;
        }

        .settings-btn.clear {
            background: #e74c3c;
        }

        .settings-btn.clear:hover {
            background: #c0392b;
        }

        .settings-section {
            margin-bottom: 25px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e3f2fd;
        }

        .settings-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .size-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .naming-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e3f2fd;
            margin: 20px 0;
        }

        .naming-example {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .background-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .background-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .background-option:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .background-option.selected {
            border-color: #27ae60;
            background: #d4edda;
        }

        .background-preview {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 2px solid #ddd;
        }

        .format-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .format-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .format-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .video-quality-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .video-quality-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-quality-option:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .video-quality-option.selected {
            border-color: #27ae60;
            background: #d4edda;
        }

        .quality-info {
            font-size: 0.8em;
            color: #666;
            margin-left: auto;
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .preset-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .preset-btn:hover {
            background: #7f8c8d;
        }

        .ai-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .ai-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        /* AI –°–û–í–ï–¢–ù–ò–ö –°–¢–ò–õ–ò */
        .ai-advisor-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .ai-advisor-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ai-tip {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #27ae60;
        }

        .ai-tip-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .ai-tip-content {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .ai-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .ai-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        .ai-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .ai-btn.secondary {
            background: rgba(39, 174, 96, 0.3);
            border-color: rgba(39, 174, 96, 0.5);
        }

        .ai-results {
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        .ai-stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .ai-tips-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-tip-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 15px;
            border-left: 3px solid #3498db;
            animation: slideIn 0.3s ease;
        }

        .ai-tip-item:nth-child(2n) {
            border-left-color: #9b59b6;
        }

        .ai-tip-item:nth-child(3n) {
            border-left-color: #e74c3c;
        }

        .color-palette {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .color-swatch::after {
            content: attr(data-hex);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7em;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .color-swatch:hover::after {
            opacity: 1;
        }

        .image-analysis-result {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .analysis-technical {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .tech-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 6px;
        }

        .tech-value {
            font-weight: bold;
            font-size: 1.1em;
            color: #27ae60;
        }

        .process-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: transform 0.2s ease;
        }

        .process-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }

        .process-btn:active {
            transform: translateY(0);
        }

        .process-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin: 20px 30px;
            padding: 25px;
            background: #e8f5e8;
            border-radius: 15px;
            border-left: 4px solid #27ae60;
        }

        .result-files {
            margin-top: 15px;
        }

        .result-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #27ae60;
        }

        .file-size-compression {
            font-size: 0.8em;
            color: #27ae60;
            margin-left: 10px;
        }

        .download-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .download-btn:hover {
            background: #2980b9;
        }

        .hidden {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            width: 0%;
            transition: width 0.3s ease;
        }

        .download-section {
            text-align: center;
            padding: 20px;
            background: #f0f8ff;
            margin: 20px 30px;
            border-radius: 15px;
            border: 2px dashed #9b59b6;
        }

        .download-all-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .download-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(155, 89, 182, 0.3);
        }

        .stats {
            text-align: center;
            margin: 10px 0;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .resolution-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .resolution-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .resolution-option:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .resolution-option.selected {
            border-color: #27ae60;
            background: #d4edda;
        }

        .checkbox-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .checkbox-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.3s ease;
        }

        .checkbox-btn:hover {
            background: #2980b9;
        }

        .checkbox-btn.select-all {
            background: #27ae60;
        }

        .checkbox-btn.select-all:hover {
            background: #219a52;
        }

        .checkbox-btn.clear-all {
            background: #e74c3c;
        }

        .checkbox-btn.clear-all:hover {
            background: #c0392b;
        }

        .naming-options {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .naming-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .empty-state .upload-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .file-thumbnail {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
        }

        .cancel-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }

        .cancel-btn:hover {
            background: #c0392b;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateX(-10px);
            }
            to { 
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .ai-actions {
                flex-direction: column;
            }
            
            .ai-btn {
                flex: none;
            }
            
            .analysis-technical {
                grid-template-columns: 1fr 1fr;
            }
            
            .file-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .file-rename {
                margin-left: 0;
                width: 100%;
            }
            
            .rename-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ MediaProcessor</h1>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ | Relation-AI Module</p>
        </div>

        <div class="upload-zone" id="dropZone">
            <div class="upload-icon">üìÅ</div>
            <h3>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</h3>
            <p>–∏–ª–∏</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
            </button>
            <input type="file" id="fileInput" class="file-input" multiple accept="image/*,.mp3,.mp4,.mov,.avi,.ogg,.wav,.flac,.aac,.mkv,.webm">
        </div>

        <div class="file-list" id="fileList">
            <div class="empty-state" id="emptyState">
                <div class="upload-icon">üìÑ</div>
                <h3>–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É</p>
            </div>
        </div>

        <div class="settings">
            <div class="settings-header">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
                <div class="settings-controls">
                    <button class="settings-btn reset" onclick="appState.resetAllSettings()">
                        üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë
                    </button>
                    <button class="settings-btn clear" onclick="appState.clearAllCheckboxes()">
                        ‚ùå –£–±—Ä–∞—Ç—å –≥–∞–ª–æ—á–∫–∏
                    </button>
                </div>
            </div>

            <div class="naming-section">
                <h3>üè∑Ô∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤</h3>
                <p style="color: #666; margin-bottom: 10px;">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ —Å–ø–∏—Å–∫–µ –≤—ã—à–µ</p>
                
                <div class="naming-options">
                    <div class="naming-option">
                        <input type="checkbox" id="useOriginalNames">
                        <label for="useOriginalNames">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤</label>
                    </div>
                </div>
                
                <div class="naming-example">
                    –ü—Ä–∏–º–µ—Ä –∏–º–µ–Ω –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏: <strong id="namingExample">banner.jpg, banner.png</strong>
                </div>
            </div>

            <!-- AI –°–û–í–ï–¢–ù–ò–ö -->
            <div class="ai-advisor-section">
                <h3>üß† AI-–°–æ–≤–µ—Ç–Ω–∏–∫</h3>
                <div class="ai-advisor-card">
                    <div class="ai-tip" id="aiTip">
                        <div class="ai-tip-header">
                            <span class="ai-icon">üí°</span>
                            <strong>–°–æ–≤–µ—Ç–Ω–∏–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</strong>
                        </div>
                        <div class="ai-tip-content">
                            –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                        </div>
                    </div>
                    
                    <div class="ai-actions">
                        <button class="ai-btn" onclick="appState.getAIAdvice()" id="aiAdviceBtn">
                            ü§ñ –ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç—ã
                        </button>
                        <button class="ai-btn secondary" onclick="appState.analyzeAllImages()" id="analyzeImagesBtn">
                            üé® –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                        </button>
                    </div>
                    
                    <div class="ai-results hidden" id="aiResults">
                        <div class="ai-stats" id="aiStats"></div>
                        <div class="ai-tips-list" id="aiTipsList"></div>
                    </div>
                </div>
            </div>

            <!-- AI –°–µ–∫—Ü–∏—è -->
            <div class="ai-section">
                <h3>üß† AI-–ê–Ω–∞–ª–∏–∑ –±—Ä–µ–Ω–¥–∞</h3>
                <div class="checkbox-controls">
                    <button class="checkbox-btn select-all" onclick="appState.selectAllCheckboxes('ai')">
                        ‚úÖ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ AI
                    </button>
                    <button class="checkbox-btn clear-all" onclick="appState.clearCheckboxes('ai')">
                        ‚ùå –£–±—Ä–∞—Ç—å –≤—Å–µ AI
                    </button>
                </div>
                <div class="ai-feature">
                    <input type="checkbox" id="aiAnalysis">
                    <label for="aiAnalysis">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</label>
                </div>
                <div class="ai-feature">
                    <input type="checkbox" id="smartRenaming">
                    <label for="smartRenaming">–£–º–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ</label>
                </div>
                <button class="upload-btn" onclick="appState.analyzeBrandAssets()" style="background: #9b59b6;">
                    üîç –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–µ–Ω–¥
                </button>
            </div>

            <div class="settings-section">
                <h3>üì∑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h3>
                <input type="text" class="size-input" id="imageSizes" 
                       value="1200x600, 800x400, 400x200" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é">
                
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="appState.loadPreset('creatives')">–ö—Ä–µ–∞—Ç–∏–≤—ã</button>
                    <button class="preset-btn" onclick="appState.loadPreset('vertical')">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ</button>
                    <button class="preset-btn" onclick="appState.loadPreset('logos')">–õ–æ–≥–æ—Ç–∏–ø—ã</button>
                    <button class="preset-btn" onclick="appState.loadPreset('icons')">–ò–∫–æ–Ω–∫–∏</button>
                </div>

                <div class="checkbox-controls">
                    <button class="checkbox-btn select-all" onclick="appState.selectAllCheckboxes('image')">
                        ‚úÖ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã
                    </button>
                    <button class="checkbox-btn clear-all" onclick="appState.clearCheckboxes('image')">
                        ‚ùå –£–±—Ä–∞—Ç—å –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã
                    </button>
                </div>
                <div class="format-options">
                    <label class="format-option">
                        <input type="checkbox" id="formatPNG"> PNG
                    </label>
                    <label class="format-option">
                        <input type="checkbox" id="formatJPG"> JPG
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>üéµ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ</h3>
                <div class="checkbox-controls">
                    <button class="checkbox-btn select-all" onclick="appState.selectAllCheckboxes('audio')">
                        ‚úÖ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã
                    </button>
                    <button class="checkbox-btn clear-all" onclick="appState.clearCheckboxes('audio')">
                        ‚ùå –£–±—Ä–∞—Ç—å –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã
                    </button>
                </div>
                <div class="format-options">
                    <label class="format-option">
                        <input type="checkbox" id="audioMP3"> MP3
                    </label>
                    <label class="format-option">
                        <input type="checkbox" id="audioOGG"> OGG
                    </label>
                </div>
                <select class="size-input" id="audioBitrate" style="margin-top: 10px;">
                    <option value="128">128 kbps (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                    <option value="192">192 kbps (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ)</option>
                    <option value="256">256 kbps (–ø—Ä–µ–º–∏—É–º)</option>
                    <option value="320">320 kbps (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ)</option>
                </select>
            </div>

            <div class="settings-section">
                <h3>üé¨ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–µ–æ</h3>
                
                <h4 style="margin: 10px 0 5px 0;">üìê –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</h4>
                <div class="resolution-options">
                    <div class="resolution-option selected" data-resolution="640x360">
                        <span>640√ó360px</span>
                    </div>
                    <div class="resolution-option" data-resolution="854x480">
                        <span>854√ó480px</span>
                    </div>
                    <div class="resolution-option" data-resolution="1280x720">
                        <span>1280√ó720px (HD)</span>
                    </div>
                </div>

                <h4 style="margin: 15px 0 5px 0;">üéØ –ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è:</h4>
                <div class="video-quality-options">
                    <div class="video-quality-option" data-quality="high">
                        <span>–í—ã—Å–æ–∫–æ–µ (CRF 18)</span>
                        <span class="quality-info">~60% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</span>
                    </div>
                    <div class="video-quality-option selected" data-quality="medium">
                        <span>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ (CRF 23)</span>
                        <span class="quality-info">~40% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</span>
                    </div>
                    <div class="video-quality-option" data-quality="low">
                        <span>–≠–∫–æ–Ω–æ–º–Ω–æ–µ (CRF 28)</span>
                        <span class="quality-info">~25% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats" id="statsInfo"></div>

        <button class="process-btn" id="processBtn">
            üöÄ –ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
        </button>

        <div class="progress-bar hidden" id="progressBar">
            <div class="progress" id="progress"></div>
        </div>

        <div class="result hidden" id="result">
            <h3>‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h3>
            <div class="result-files" id="resultFiles"></div>
        </div>

        <div class="download-section hidden" id="downloadSection">
            <button class="download-all-btn" id="downloadAllBtn">
                üíæ –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã (ZIP)
            </button>
            <p style="text-align: center; margin-top: 10px; color: #666;">
                –ë—É–¥–µ—Ç —Å–∫–∞—á–∞–Ω ZIP-–∞—Ä—Ö–∏–≤ —Å–æ –≤—Å–µ–º–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            </p>
        </div>
    </div>

    <script>
        // ===============================
        // –†–ï–ê–õ–¨–ù–´–ô AI-–ê–ù–ê–õ–ò–ó –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ß–ï–†–ï–ó CANVAS API
        // ===============================
        class RealTimeImageAnalyzer {
            static async analyzeImageColors(imageFile) {
                return new Promise((resolve) => {
                    const img = new Image();
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    img.onload = () => {
                        canvas.width = Math.min(img.width, 200);
                        canvas.height = Math.min(img.height, 200);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const analysis = {
                            dominantColors: this.extractDominantColors(imageData),
                            brightness: this.calculateBrightness(imageData),
                            contrast: this.calculateContrast(imageData),
                            aspectRatio: (img.width / img.height).toFixed(2),
                            resolution: `${img.width}x${img.height}`
                        };
                        
                        URL.revokeObjectURL(img.src);
                        resolve(analysis);
                    };
                    
                    img.onerror = () => resolve(null);
                    img.src = URL.createObjectURL(imageFile);
                });
            }
            
            static extractDominantColors(imageData) {
                const colorMap = {};
                const data = imageData.data;
                const colorBuckets = {};
                
                for (let i = 0; i < data.length; i += 16) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    const bucket = `${Math.floor(r/32)*32},${Math.floor(g/32)*32},${Math.floor(b/32)*32}`;
                    colorBuckets[bucket] = (colorBuckets[bucket] || 0) + 1;
                }
                
                return Object.entries(colorBuckets)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([bucket]) => {
                        const [r, g, b] = bucket.split(',').map(Number);
                        return {
                            rgb: `rgb(${r},${g},${b})`,
                            hex: this.rgbToHex(r, g, b),
                            name: this.colorToName(r, g, b)
                        };
                    });
            }
            
            static calculateBrightness(imageData) {
                const data = imageData.data;
                let totalBrightness = 0;
                let count = 0;
                
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    totalBrightness += (r + g + b) / 3;
                    count++;
                }
                
                return Math.round(totalBrightness / count);
            }
            
            static calculateContrast(imageData) {
                const data = imageData.data;
                const brightnessValues = [];
                
                for (let i = 0; i < data.length; i += 4) {
                    const brightness = (data[i] + data[i+1] + data[i+2]) / 3;
                    brightnessValues.push(brightness);
                }
                
                const max = Math.max(...brightnessValues);
                const min = Math.min(...brightnessValues);
                return Math.round(max - min);
            }
            
            static rgbToHex(r, g, b) {
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
            }
            
            static colorToName(r, g, b) {
                if (r > 200 && g > 200 && b > 200) return '–±–µ–ª—ã–π';
                if (r < 50 && g < 50 && b < 50) return '—á–µ—Ä–Ω—ã–π';
                if (r > g * 1.5 && r > b * 1.5) return '–∫—Ä–∞—Å–Ω—ã–π';
                if (g > r * 1.5 && g > b * 1.5) return '–∑–µ–ª–µ–Ω—ã–π';
                if (b > r * 1.5 && b > g * 1.5) return '—Å–∏–Ω–∏–π';
                if (r > 200 && g > 200) return '–∂–µ–ª—Ç—ã–π';
                if (r > 200 && b > 200) return '–ø—É—Ä–ø—É—Ä–Ω—ã–π';
                if (g > 200 && b > 200) return '–≥–æ–ª—É–±–æ–π';
                return '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π';
            }
            
            static getImageTypeSuggestions(analysis) {
                const suggestions = [];
                
                if (analysis.brightness < 80) {
                    suggestions.push('–ù–∏–∑–∫–∞—è —è—Ä–∫–æ—Å—Ç—å - —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∫–æ—Ä—Ä–µ–∫—Ü–∏—é');
                }
                if (analysis.contrast < 50) {
                    suggestions.push('–ù–∏–∑–∫–∞—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å - –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å');
                }
                if (parseFloat(analysis.aspectRatio) > 2) {
                    suggestions.push('–®–∏—Ä–æ–∫–æ—Ñ–æ—Ä–º–∞—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –±–∞–Ω–Ω–µ—Ä–æ–≤');
                }
                if (parseFloat(analysis.aspectRatio) < 0.5) {
                    suggestions.push('–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å—Ç–æ—Ä–∏—Å');
                }
                
                return suggestions;
            }
        }

        // ===============================
        // –ë–´–°–¢–†–´–ô AI-–°–û–í–ï–¢–ù–ò–ö
        // ===============================
        class AIAdvisor {
            static async analyzeFiles(files) {
                const tips = [];
                const stats = {
                    totalImages: 0,
                    totalVideos: 0,
                    totalAudio: 0,
                    largeFiles: 0,
                    totalSize: 0
                };
                
                files.forEach(file => {
                    const type = FileUtils.getFileType(file.name);
                    stats.totalSize += file.size;
                    
                    if (type === '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ') stats.totalImages++;
                    if (type === '–í–∏–¥–µ–æ') stats.totalVideos++;
                    if (type === '–ê—É–¥–∏–æ') stats.totalAudio++;
                    if (file.size > 5 * 1024 * 1024) stats.largeFiles++;
                });
                
                if (stats.totalImages > 10) {
                    tips.push(`üéØ <strong>–ú–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (${stats.totalImages})</strong> - —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É`);
                }
                
                if (stats.totalVideos > 3) {
                    tips.push(`üé¨ <strong>–í–∏–¥–µ–æ—Ñ–∞–π–ª—ã (${stats.totalVideos})</strong> - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ`);
                }
                
                if (stats.largeFiles > 0) {
                    tips.push(`üíæ <strong>–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (${stats.largeFiles})</strong> - —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å–∂–∞—Ç–∏–µ`);
                }
                
                if (stats.totalImages > 0) {
                    const avgSize = stats.totalSize / stats.totalImages / 1024 / 1024;
                    if (avgSize > 2) {
                        tips.push(`üì∏ <strong>–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä: ${avgSize.toFixed(1)}MB</strong> - –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å`);
                    }
                }
                
                const hasPNG = files.some(f => f.name.toLowerCase().endsWith('.png'));
                const hasJPG = files.some(f => f.name.toLowerCase().endsWith('.jpg') || f.name.toLowerCase().endsWith('.jpeg'));
                
                if (hasPNG && !hasJPG) {
                    tips.push("üñºÔ∏è <strong>–¢–æ–ª—å–∫–æ PNG</strong> - –¥–ª—è –≤–µ–±–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ JPG");
                }
                
                if (files.length > 15) {
                    tips.push("‚ö° <strong>–ú–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤</strong> - —Ä–∞–∑–±–µ–π—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏–π");
                }
                
                if (tips.length === 0) {
                    tips.push("‚úÖ –§–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏");
                }
                
                return {
                    tips: tips,
                    stats: stats,
                    recommendation: this.generateOverallRecommendation(stats)
                };
            }
            
            static generateOverallRecommendation(stats) {
                if (stats.totalImages > stats.totalVideos + stats.totalAudio) {
                    return "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π";
                }
                if (stats.totalVideos > stats.totalImages + stats.totalAudio) {
                    return "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç - –≤–∏–¥–µ–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ";
                }
                if (stats.totalAudio > stats.totalImages + stats.totalVideos) {
                    return "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç - –∞—É–¥–∏–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MP3";
                }
                return "–°–º–µ—à–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏";
            }
            
            static async getDetailedImageAdvice(imageFile) {
                try {
                    const analysis = await RealTimeImageAnalyzer.analyzeImageColors(imageFile);
                    if (!analysis) return null;
                    
                    const advice = {
                        colors: analysis.dominantColors.slice(0, 3),
                        technical: {
                            resolution: analysis.resolution,
                            aspectRatio: analysis.aspectRatio,
                            brightness: analysis.brightness,
                            contrast: analysis.contrast
                        },
                        suggestions: RealTimeImageAnalyzer.getImageTypeSuggestions(analysis)
                    };
                    
                    return advice;
                } catch (error) {
                    console.error('AI –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª—Å—è:', error);
                    return null;
                }
            }
        }

        // ===============================
        // –ö–õ–ê–°–° –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–û–°–¢–û–Ø–ù–ò–ï–ú
        // ===============================
        class AppState {
            constructor() {
                this.uploadedFiles = [];
                this.processedFilesStorage = [];
                this.isProcessing = false;
                this.currentProcessor = null;
                this.settings = this.loadSettings();
                this.listeners = [];
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateStats();
                this.updateFileList();
                this.updateNamingExample();
            }

            loadSettings() {
                const saved = localStorage.getItem('mediaProcessorSettings');
                const defaults = {
                    selectedVideoResolution: '640x360',
                    selectedVideoQuality: 'medium',
                    imageSizes: '1200x600, 800x400, 400x200',
                    defaultCheckboxes: {
                        formatPNG: false,
                        formatJPG: true,
                        audioMP3: true,
                        audioOGG: false,
                        aiAnalysis: false,
                        smartRenaming: false,
                        useOriginalNames: false
                    }
                };
                
                if (saved) {
                    const parsed = JSON.parse(saved);
                    return {...defaults, ...parsed};
                }
                return defaults;
            }

            saveSettings() {
                localStorage.setItem('mediaProcessorSettings', JSON.stringify(this.settings));
            }

            updateNamingExample() {
                const exampleElement = document.getElementById('namingExample');
                const useOriginal = document.getElementById('useOriginalNames').checked;
                
                if (useOriginal) {
                    exampleElement.textContent = 'image.jpg, photo.png (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞)';
                } else {
                    exampleElement.textContent = 'banner.jpg, banner.png (–ø—Ä–æ—Å—Ç—ã–µ –∏–º–µ–Ω–∞)';
                }
            }

            generateFileName(baseName, format, fileType, originalName = '') {
                const useOriginal = document.getElementById('useOriginalNames').checked;
                
                if (useOriginal && originalName) {
                    const originalBase = originalName.replace(/\.[^/.]+$/, "");
                    return `${originalBase}.${format}`;
                }
                
                return `${baseName}.${format}`;
            }

            resetAllSettings() {
                if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                    this.settings.selectedVideoResolution = '640x360';
                    this.settings.selectedVideoQuality = 'medium';
                    this.settings.imageSizes = '1200x600, 800x400, 400x200';
                    
                    this.resetCheckboxesToDefault();
                    this.loadUISettings();
                    this.saveSettings();
                    this.updateStats();
                    this.updateNamingExample();
                    
                    UIManager.showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', '–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
                }
            }

            resetCheckboxesToDefault() {
                const defaultStates = this.settings.defaultCheckboxes;
                
                Object.keys(defaultStates).forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.checked = defaultStates[checkboxId];
                    }
                });
            }

            clearAllCheckboxes() {
                if (confirm('–£–±—Ä–∞—Ç—å –≤—Å–µ –≥–∞–ª–æ—á–∫–∏ —Å–æ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫?')) {
                    this.clearAllCheckboxesState();
                    UIManager.showSuccess('–ì–∞–ª–æ—á–∫–∏ —É–±—Ä–∞–Ω—ã', '–í—Å–µ —á–µ–∫–±–æ–∫—Å—ã –æ—á–∏—â–µ–Ω—ã');
                }
            }

            clearAllCheckboxesState() {
                const allCheckboxes = [
                    'formatPNG', 'formatJPG', 
                    'audioMP3', 'audioOGG',
                    'aiAnalysis', 'smartRenaming',
                    'useOriginalNames'
                ];
                
                allCheckboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.checked = false;
                    }
                });
                
                this.updateStats();
                this.updateNamingExample();
            }

            selectAllCheckboxes(type) {
                switch(type) {
                    case 'image':
                        document.getElementById('formatPNG').checked = true;
                        document.getElementById('formatJPG').checked = true;
                        break;
                    case 'audio':
                        document.getElementById('audioMP3').checked = true;
                        document.getElementById('audioOGG').checked = true;
                        break;
                    case 'ai':
                        document.getElementById('aiAnalysis').checked = true;
                        document.getElementById('smartRenaming').checked = true;
                        break;
                }
                this.updateStats();
            }

            clearCheckboxes(type) {
                switch(type) {
                    case 'image':
                        document.getElementById('formatPNG').checked = false;
                        document.getElementById('formatJPG').checked = false;
                        break;
                    case 'audio':
                        document.getElementById('audioMP3').checked = false;
                        document.getElementById('audioOGG').checked = false;
                        break;
                    case 'ai':
                        document.getElementById('aiAnalysis').checked = false;
                        document.getElementById('smartRenaming').checked = false;
                        break;
                }
                this.updateStats();
            }

            // AI-–°–û–í–ï–¢–ù–ò–ö –ú–ï–¢–û–î–´
            async getAIAdvice() {
                if (this.uploadedFiles.length === 0) {
                    UIManager.showError('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                    return;
                }

                const aiAdviceBtn = document.getElementById('aiAdviceBtn');
                const originalText = aiAdviceBtn.innerHTML;
                aiAdviceBtn.innerHTML = '‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
                aiAdviceBtn.disabled = true;

                try {
                    const advice = await AIAdvisor.analyzeFiles(this.uploadedFiles);
                    this.displayAIAdvice(advice);
                    
                    UIManager.showSuccess('AI-–∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω', '–ü–æ–ª—É—á–µ–Ω—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ AI-—Å–æ–≤–µ—Ç–Ω–∏–∫–∞', error);
                    UIManager.showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç—ã');
                } finally {
                    aiAdviceBtn.innerHTML = originalText;
                    aiAdviceBtn.disabled = false;
                }
            }

            async analyzeAllImages() {
                const imageFiles = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'
                );
                
                if (imageFiles.length === 0) {
                    UIManager.showError('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                    return;
                }

                const analyzeBtn = document.getElementById('analyzeImagesBtn');
                const originalText = analyzeBtn.innerHTML;
                analyzeBtn.innerHTML = `üé® –ê–Ω–∞–ª–∏–∑ (0/${imageFiles.length})...`;
                analyzeBtn.disabled = true;

                try {
                    const results = [];
                    
                    for (let i = 0; i < imageFiles.length; i++) {
                        const file = imageFiles[i];
                        analyzeBtn.innerHTML = `üé® –ê–Ω–∞–ª–∏–∑ (${i+1}/${imageFiles.length})...`;
                        
                        const analysis = await AIAdvisor.getDetailedImageAdvice(file);
                        if (analysis) {
                            results.push({
                                fileName: file.name,
                                analysis: analysis
                            });
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    this.displayImageAnalysis(results);
                    UIManager.showSuccess(
                        '–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω', 
                        `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${results.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`
                    );
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π', error);
                    UIManager.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π');
                } finally {
                    analyzeBtn.innerHTML = originalText;
                    analyzeBtn.disabled = false;
                }
            }

            displayAIAdvice(advice) {
                const aiResults = document.getElementById('aiResults');
                const aiStats = document.getElementById('aiStats');
                const aiTipsList = document.getElementById('aiTipsList');
                
                aiStats.innerHTML = `
                    <strong>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:</strong><br>
                    ‚Ä¢ üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${advice.stats.totalImages}<br>
                    ‚Ä¢ üé¨ –í–∏–¥–µ–æ: ${advice.stats.totalVideos}<br>
                    ‚Ä¢ üéµ –ê—É–¥–∏–æ: ${advice.stats.totalAudio}<br>
                    ‚Ä¢ üíæ –ë–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤: ${advice.stats.largeFiles}<br>
                    ‚Ä¢ üì¶ –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: ${(advice.stats.totalSize / 1024 / 1024).toFixed(1)}MB
                `;
                
                aiTipsList.innerHTML = '';
                advice.tips.forEach(tip => {
                    const tipElement = document.createElement('div');
                    tipElement.className = 'ai-tip-item';
                    tipElement.innerHTML = tip;
                    aiTipsList.appendChild(tipElement);
                });
                
                const overallTip = document.createElement('div');
                overallTip.className = 'ai-tip-item';
                overallTip.style.borderLeftColor = '#f39c12';
                overallTip.innerHTML = `üéØ <strong>–û–±—â–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${advice.recommendation}`;
                aiTipsList.appendChild(overallTip);
                
                aiResults.classList.remove('hidden');
            }

            displayImageAnalysis(results) {
                const aiResults = document.getElementById('aiResults');
                const aiStats = document.getElementById('aiStats');
                const aiTipsList = document.getElementById('aiTipsList');
                
                aiStats.innerHTML = `
                    <strong>üé® –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</strong><br>
                    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${results.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                `;
                
                aiTipsList.innerHTML = '';
                
                results.forEach(result => {
                    const analysis = result.analysis;
                    const analysisElement = document.createElement('div');
                    analysisElement.className = 'image-analysis-result';
                    
                    analysisElement.innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <strong>üìÑ ${result.fileName}</strong>
                        </div>
                        
                        <div class="analysis-technical">
                            <div class="tech-item">
                                <div>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ</div>
                                <div class="tech-value">${analysis.technical.resolution}</div>
                            </div>
                            <div class="tech-item">
                                <div>–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ</div>
                                <div class="tech-value">${analysis.technical.aspectRatio}</div>
                            </div>
                            <div class="tech-item">
                                <div>–Ø—Ä–∫–æ—Å—Ç—å</div>
                                <div class="tech-value">${analysis.technical.brightness}</div>
                            </div>
                            <div class="tech-item">
                                <div>–ö–æ–Ω—Ç—Ä–∞—Å—Ç</div>
                                <div class="tech-value">${analysis.technical.contrast}</div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞:</strong>
                            <div class="color-palette">
                                ${analysis.colors.map(color => 
                                    `<div class="color-swatch" style="background: ${color.rgb};" 
                                          data-hex="${color.hex}" title="${color.name}"></div>`
                                ).join('')}
                            </div>
                        </div>
                        
                        ${analysis.suggestions.length > 0 ? `
                            <div>
                                <strong>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    ${analysis.suggestions.map(suggestion => 
                                        `<li style="font-size: 0.9em; margin: 3px 0;">${suggestion}</li>`
                                    ).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    `;
                    
                    aiTipsList.appendChild(analysisElement);
                });
                
                aiResults.classList.remove('hidden');
            }

            // –û–°–¢–ê–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
            subscribe(listener) {
                this.listeners.push(listener);
            }

            notify() {
                this.listeners.forEach(listener => listener(this));
            }

            setFiles(files) {
                this.uploadedFiles = files;
                this.updateFileList();
                this.updateStats();
                this.notify();
            }

            clearAllFiles() {
                this.uploadedFiles.forEach(file => {
                    if (file.objectURL) {
                        URL.revokeObjectURL(file.objectURL);
                    }
                    if (file.thumbnail && file.thumbnail.startsWith('blob:')) {
                        URL.revokeObjectURL(file.thumbnail);
                    }
                });
                
                this.uploadedFiles = [];
                this.setFiles(this.uploadedFiles);
                UIManager.showSuccess('–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', '–í—Å–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã');
            }

            async handleFileSelect(event) {
                const newFiles = Array.from(event.target.files);
                await this.addFiles(newFiles);
            }

            async handleDrop(event) {
                event.preventDefault();
                document.getElementById('dropZone').classList.remove('dragover');
                
                const newFiles = Array.from(event.dataTransfer.files);
                await this.addFiles(newFiles);
            }

            async addFiles(newFiles) {
                const validatedFiles = [];
                
                for (const file of newFiles) {
                    try {
                        FileValidator.validateFile(file);
                        file.customName = file.name.replace(/\.[^/.]+$/, "");
                        file.thumbnail = await ThumbnailGenerator.createThumbnail(file);
                        validatedFiles.push(file);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞', error);
                        UIManager.showError(`–§–∞–π–ª "${file.name}" –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω: ${error.message}`);
                    }
                }

                if (validatedFiles.length > 0) {
                    const currentCustomNames = {};
                    this.uploadedFiles.forEach(file => {
                        currentCustomNames[file.name] = file.customName;
                    });
                    
                    this.uploadedFiles = [...this.uploadedFiles, ...validatedFiles];
                    this.uploadedFiles.forEach(file => {
                        file.customName = currentCustomNames[file.name] || file.customName;
                    });
                    
                    this.setFiles(this.uploadedFiles);
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º AI-—Å–æ–≤–µ—Ç–Ω–∏–∫
                    setTimeout(() => {
                        if (this.uploadedFiles.length > 0) {
                            this.getAIAdvice();
                        }
                    }, 1000);
                }
            }

            removeFile(index) {
                if (this.uploadedFiles[index]?.objectURL) {
                    URL.revokeObjectURL(this.uploadedFiles[index].objectURL);
                }
                if (this.uploadedFiles[index]?.thumbnail?.startsWith('blob:')) {
                    URL.revokeObjectURL(this.uploadedFiles[index].thumbnail);
                }
                this.uploadedFiles.splice(index, 1);
                this.setFiles(this.uploadedFiles);
            }

            updateFileName(index, newName) {
                if (this.uploadedFiles[index] && newName.trim() !== '') {
                    this.uploadedFiles[index].customName = newName.trim();
                    this.updateFileList();
                }
            }

            updateFileList() {
                const fileList = document.getElementById('fileList');
                const emptyState = document.getElementById('emptyState');
                
                if (this.uploadedFiles.length === 0) {
                    fileList.innerHTML = '';
                    fileList.appendChild(emptyState);
                    return;
                }

                const fragment = document.createDocumentFragment();
                
                const header = document.createElement('div');
                header.className = 'file-list-header';
                header.innerHTML = `
                    <h3>üìÑ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h3>
                    <button class="clear-all-btn" id="clearAllBtn">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                    </button>
                `;
                fragment.appendChild(header);

                this.uploadedFiles.forEach((file, index) => {
                    const fileElement = this.createFileElement(file, index);
                    fragment.appendChild(fileElement);
                });

                fileList.innerHTML = '';
                fileList.appendChild(fragment);

                document.getElementById('clearAllBtn').addEventListener('click', () => {
                    this.clearAllFiles();
                });
            }

            createFileElement(file, index) {
                const fileType = FileUtils.getFileType(file.name);
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div class="file-info">
                        ${file.thumbnail ? 
                            `<img src="${file.thumbnail}" class="file-thumbnail" alt="–ü—Ä–µ–≤—å—é">` : 
                            `<span class="file-icon">${FileUtils.getFileIcon(fileType)}</span>`
                        }
                        <div>
                            <div><strong>${this.escapeHtml(file.name)}</strong></div>
                            <div class="file-size">${fileSize} MB ‚Ä¢ ${fileType}</div>
                            <div style="color: #27ae60; font-size: 0.8em; margin-top: 2px;">
                                ‚û°Ô∏è –ù–æ–≤–æ–µ –∏–º—è: <strong>${this.escapeHtml(file.customName)}</strong>.*
                            </div>
                        </div>
                    </div>
                    <div class="file-rename">
                        <input type="text" class="rename-input" value="${this.escapeHtml(file.customName)}" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è" 
                               data-index="${index}">
                    </div>
                    <button class="cancel-btn" data-index="${index}">√ó</button>
                `;

                const input = item.querySelector('input');
                input.addEventListener('input', (e) => {
                    this.updateFileName(index, e.target.value);
                });

                const button = item.querySelector('.cancel-btn');
                button.addEventListener('click', () => {
                    this.removeFile(index);
                });

                return item;
            }

            escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            updateStats() {
                const statsInfo = document.getElementById('statsInfo');
                if (this.uploadedFiles.length === 0) {
                    statsInfo.innerHTML = '';
                    return;
                }

                const imageCount = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ').length;
                const audioCount = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–ê—É–¥–∏–æ').length;
                const videoCount = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–í–∏–¥–µ–æ').length;

                const totalOutputFiles = this.calculateOutputFilesCount();
                const efficiency = this.calculateEfficiencyMetrics();
                
                statsInfo.innerHTML = `
                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${this.uploadedFiles.length} —Ñ–∞–π–ª–æ–≤ (üì∑${imageCount} üéµ${audioCount} üé¨${videoCount}) 
                    ‚Üí ${totalOutputFiles} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
                    <br>‚è±Ô∏è –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: ~${efficiency.timeSaved} –º–∏–Ω—É—Ç
                `;
            }

            async analyzeBrandAssets() {
                const imageFiles = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                
                if (imageFiles.length === 0) {
                    UIManager.showError('–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±—Ä–µ–Ω–¥–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                    return;
                }

                try {
                    const analysis = await AIService.analyzeBrand(imageFiles);
                    
                    document.getElementById('imageSizes').value = analysis.suggestedSizes.join(', ');
                    this.settings.imageSizes = analysis.suggestedSizes.join(', ');
                    this.saveSettings();
                    
                    if (document.getElementById('smartRenaming').checked) {
                        this.uploadedFiles.forEach((file, index) => {
                            file.customName = AIService.generateSmartFilename(
                                file.name, 
                                FileUtils.getFileType(file.name)
                            );
                        });
                        this.updateFileList();
                    }
                    
                    this.updateStats();
                    
                    UIManager.showSuccess(
                        `AI-–∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!`,
                        `–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞: ${analysis.dominantColors.join(', ')}\n` +
                        `–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã: ${analysis.suggestedSizes.join(', ')}`
                    );
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ AI-–∞–Ω–∞–ª–∏–∑–∞', error);
                    UIManager.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –±—Ä–µ–Ω–¥–∞');
                }
            }

            async startProcessing() {
                if (this.uploadedFiles.length === 0) {
                    UIManager.showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã!');
                    return;
                }

                if (this.isProcessing) {
                    UIManager.showError('–û–±—Ä–∞–±–æ—Ç–∫–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è!');
                    return;
                }

                this.isProcessing = true;
                this.currentProcessor = new MediaProcessor();
                
                UIManager.showProcessingState(true);
                this.processedFilesStorage = [];

                try {
                    await this.currentProcessor.processFiles(
                        this.uploadedFiles,
                        this.settings,
                        (progress) => {
                            UIManager.updateProgress(progress);
                        },
                        (processedFiles) => {
                            this.processedFilesStorage.push(...processedFiles);
                        }
                    );

                    UIManager.showResults(this.processedFilesStorage);
                    UIManager.showProcessingState(false);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏', error);
                    UIManager.showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–æ–≤');
                } finally {
                    this.isProcessing = false;
                    this.currentProcessor = null;
                    UIManager.showProcessingState(false);
                }
            }

            cancelProcessing() {
                if (this.currentProcessor) {
                    this.currentProcessor.cancel();
                }
                this.isProcessing = false;
                UIManager.showProcessingState(false);
            }

            calculateOutputFilesCount() {
                let total = 0;
                
                this.uploadedFiles.forEach(file => {
                    const fileType = FileUtils.getFileType(file.name);
                    
                    if (fileType === '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ') {
                        const sizes = document.getElementById('imageSizes').value.split(',').map(s => s.trim());
                        const formats = [];
                        
                        if (document.getElementById('formatPNG').checked) formats.push('png');
                        if (document.getElementById('formatJPG').checked) formats.push('jpg');
                        
                        total += sizes.length * formats.length;
                    } 
                    else if (fileType === '–ê—É–¥–∏–æ') {
                        const formats = [];
                        if (document.getElementById('audioMP3').checked) formats.push('mp3');
                        if (document.getElementById('audioOGG').checked) formats.push('ogg');
                        total += formats.length;
                    }
                    else if (fileType === '–í–∏–¥–µ–æ') {
                        total += 1;
                    }
                });
                
                return total;
            }

            calculateEfficiencyMetrics() {
                const imageCount = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ').length;
                const videoCount = this.uploadedFiles.filter(f => 
                    FileUtils.getFileType(f.name) === '–í–∏–¥–µ–æ').length;
                
                return {
                    timeSaved: Math.round((imageCount * 2 + videoCount * 10) * 0.85),
                    originalSize: this.uploadedFiles.reduce((sum, file) => sum + file.size, 0),
                    automationLevel: '85%'
                };
            }

            loadPreset(presetName) {
                const presets = {
                    'creatives': '1200x600, 800x400, 400x200',
                    'vertical': '1080x1920, 1080x1350, 800x1200',
                    'logos': '800x800, 400x400, 200x200',
                    'icons': '512x512, 256x256, 128x128, 64x64, 32x32'
                };
                
                if (presets[presetName]) {
                    document.getElementById('imageSizes').value = presets[presetName];
                    this.settings.imageSizes = presets[presetName];
                    this.saveSettings();
                    this.updateStats();
                }
            }

            setupEventListeners() {
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    this.handleFileSelect(e);
                });

                const dropZone = document.getElementById('dropZone');
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('dragover');
                });

                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('dragover');
                });

                dropZone.addEventListener('drop', (e) => {
                    this.handleDrop(e);
                });

                document.getElementById('processBtn').addEventListener('click', () => {
                    this.startProcessing();
                });

                document.getElementById('downloadAllBtn').addEventListener('click', () => {
                    this.downloadAllFiles();
                });

                document.getElementById('imageSizes').addEventListener('input', () => {
                    this.settings.imageSizes = document.getElementById('imageSizes').value;
                    this.saveSettings();
                    this.updateStats();
                });

                document.getElementById('useOriginalNames').addEventListener('change', () => {
                    this.updateNamingExample();
                    this.updateStats();
                });

                document.querySelectorAll('.resolution-option').forEach(opt => {
                    opt.addEventListener('click', () => {
                        this.selectResolution(opt.dataset.resolution);
                    });
                });

                document.querySelectorAll('.video-quality-option').forEach(opt => {
                    opt.addEventListener('click', () => {
                        this.selectVideoQuality(opt.dataset.quality);
                    });
                });

                ['formatPNG', 'formatJPG', 'audioMP3', 'audioOGG', 'aiAnalysis', 'smartRenaming'].forEach(id => {
                    document.getElementById(id).addEventListener('change', () => {
                        this.updateStats();
                    });
                });

                this.loadUISettings();
            }

            loadUISettings() {
                document.getElementById('imageSizes').value = this.settings.imageSizes;
                
                this.selectResolution(this.settings.selectedVideoResolution, false);
                this.selectVideoQuality(this.settings.selectedVideoQuality, false);
                
                this.resetCheckboxesToDefault();
            }

            selectResolution(resolution, save = true) {
                this.settings.selectedVideoResolution = resolution;
                document.querySelectorAll('.resolution-option').forEach(opt => {
                    opt.classList.toggle('selected', opt.dataset.resolution === resolution);
                });
                if (save) this.saveSettings();
            }

            selectVideoQuality(quality, save = true) {
                this.settings.selectedVideoQuality = quality;
                document.querySelectorAll('.video-quality-option').forEach(opt => {
                    opt.classList.toggle('selected', opt.dataset.quality === quality);
                });
                if (save) this.saveSettings();
            }

            downloadSingleFile(fileName) {
                const file = this.processedFilesStorage.find(f => f.name === fileName);
                if (file) {
                    FileDownloader.downloadFile(file.blob, file.name);
                }
            }

            async downloadAllFiles() {
                if (this.processedFilesStorage.length === 0) {
                    UIManager.showError('–ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è!');
                    return;
                }

                try {
                    await FileDownloader.downloadAsZip(this.processedFilesStorage);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', error);
                    UIManager.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ö–∏–≤–∞');
                }
            }
        }

        // ===============================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ö–õ–ê–°–°–´
        // ===============================
        class FileValidator {
            static validateFile(file) {
                const maxSize = 100 * 1024 * 1024;
                const allowedTypes = [
                    'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', 'image/bmp',
                    'audio/mpeg', 'audio/mp3', 'audio/wav', 'audio/flac', 'audio/aac', 'audio/ogg',
                    'video/mp4', 'video/mov', 'video/avi', 'video/mkv', 'video/webm', 'video/ogg'
                ];

                if (file.size > maxSize) {
                    throw new Error(`–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (${(file.size / 1024 / 1024).toFixed(1)}MB). –ú–∞–∫—Å–∏–º—É–º: 100MB`);
                }

                if (!allowedTypes.some(type => file.type === type)) {
                    throw new Error('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞');
                }

                return true;
            }
        }

        class ThumbnailGenerator {
            static async createThumbnail(file) {
                if (!file.type.startsWith('image/')) {
                    return null;
                }

                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    canvas.width = 50;
                    canvas.height = 50;
                    
                    img.onload = () => {
                        const scale = Math.min(50 / img.width, 50 / img.height);
                        const width = img.width * scale;
                        const height = img.height * scale;
                        const x = (50 - width) / 2;
                        const y = (50 - height) / 2;
                        
                        ctx.fillStyle = '#f0f0f0';
                        ctx.fillRect(0, 0, 50, 50);
                        ctx.drawImage(img, x, y, width, height);
                        
                        resolve(canvas.toDataURL());
                    };
                    
                    img.onerror = () => resolve(null);
                    img.src = URL.createObjectURL(file);
                });
            }
        }

        class MediaProcessor {
            constructor() {
                this.isCancelled = false;
                this.currentOperations = new Map();
            }

            cancel() {
                this.isCancelled = true;
                this.currentOperations.forEach(operation => {
                    if (operation.cancel) operation.cancel();
                });
            }

            async processFiles(files, settings, onProgress, onFileProcessed) {
                this.isCancelled = false;
                const totalFiles = files.length;
                let processedCount = 0;

                const batchSize = 2;
                for (let i = 0; i < files.length; i += batchSize) {
                    if (this.isCancelled) break;

                    const batch = files.slice(i, i + batchSize);
                    const batchPromises = batch.map(async (file, batchIndex) => {
                        if (this.isCancelled) return [];

                        try {
                            const processedFiles = await appState.processFile(file, settings);
                            onFileProcessed(processedFiles);
                            return processedFiles;
                        } catch (error) {
                            console.error(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ ${file.name}`, error);
                            const fileName = appState.generateFileName(
                                file.customName || file.name.replace(/\.[^/.]+$/, ""), 
                                file.name.split('.').pop(), 
                                FileUtils.getFileType(file.name), 
                                file.name
                            );
                            onFileProcessed([{
                                blob: file,
                                name: fileName,
                                type: FileUtils.getFileType(file.name)
                            }]);
                            return [];
                        }
                    });

                    await Promise.all(batchPromises);
                    processedCount += batch.length;
                    onProgress((processedCount / totalFiles) * 100);

                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }
        }

        class AIService {
            static async analyzeBrand(imageFiles) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                return {
                    dominantColors: ['#2c3e50', '#3498db', '#e74c3c'],
                    suggestedSizes: ['1200x630', '1080x1080', '800x400'],
                    recommendedFormats: ['png', 'jpg'],
                    brandStyle: 'modern-corporate',
                    estimatedTimeSave: '85%'
                };
            }

            static generateSmartFilename(originalName, fileType) {
                const base = originalName.replace(/\.[^/.]+$/, "").toLowerCase();
                
                if (base.includes('logo') || base.includes('logotype')) {
                    return 'brand-logo';
                } else if (base.includes('banner') || base.includes('header')) {
                    return 'main-banner';
                } else if (base.includes('icon') || base.includes('ico')) {
                    return 'app-icon';
                } else if (base.includes('profile') || base.includes('avatar')) {
                    return 'profile-image';
                } else if (base.includes('background') || base.includes('bg')) {
                    return 'background-image';
                } else if (fileType === '–í–∏–¥–µ–æ') {
                    return 'promo-video';
                } else if (fileType === '–ê—É–¥–∏–æ') {
                    return 'brand-audio';
                }
                
                const prefixes = {
                    '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ': 'image',
                    '–ê—É–¥–∏–æ': 'audio',
                    '–í–∏–¥–µ–æ': 'video'
                };
                
                return `${prefixes[fileType] || 'file'}-${Date.now().toString().slice(-4)}`;
            }
        }

        class FileUtils {
            static getFileType(filename) {
                if (filename.match(/\.(jpg|jpeg|png|gif|webp|bmp)$/i)) return '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                if (filename.match(/\.(mp3|wav|flac|aac|ogg)$/i)) return '–ê—É–¥–∏–æ';
                if (filename.match(/\.(mp4|mov|avi|mkv|webm|ogg)$/i)) return '–í–∏–¥–µ–æ';
                return '–§–∞–π–ª';
            }

            static getFileIcon(fileType) {
                const icons = {
                    '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ': 'üñºÔ∏è',
                    '–ê—É–¥–∏–æ': 'üéµ',
                    '–í–∏–¥–µ–æ': 'üé¨',
                    '–§–∞–π–ª': 'üìÑ'
                };
                return icons[fileType] || 'üìÑ';
            }
        }

        class FileDownloader {
            static downloadFile(blob, fileName) {
                const downloadLink = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                downloadLink.href = url;
                downloadLink.download = fileName;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                
                setTimeout(() => {
                    document.body.removeChild(downloadLink);
                    URL.revokeObjectURL(url);
                }, 100);
            }

            static async downloadAsZip(files) {
                try {
                    const zip = new JSZip();
                    
                    files.forEach(file => {
                        zip.file(file.name, file.blob);
                    });
                    
                    const zipBlob = await zip.generateAsync({
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 6 }
                    });
                    
                    this.downloadFile(zipBlob, `processed_media_${new Date().getTime()}.zip`);
                    
                } catch (error) {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ZIP-–∞—Ä—Ö–∏–≤–∞: ' + error.message);
                }
            }
        }

        class UIManager {
            static showProcessingState(isProcessing) {
                const processBtn = document.getElementById('processBtn');
                const progressBar = document.getElementById('progressBar');
                
                if (isProcessing) {
                    processBtn.disabled = true;
                    processBtn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
                    processBtn.onclick = () => appState.cancelProcessing();
                    progressBar.classList.remove('hidden');
                } else {
                    processBtn.disabled = false;
                    processBtn.innerHTML = 'üöÄ –ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                    processBtn.onclick = () => appState.startProcessing();
                    progressBar.classList.add('hidden');
                    document.getElementById('progress').style.width = '0%';
                }
            }

            static updateProgress(percent) {
                document.getElementById('progress').style.width = `${percent}%`;
            }

            static showResults(files) {
                const result = document.getElementById('result');
                const resultFiles = document.getElementById('resultFiles');
                const downloadSection = document.getElementById('downloadSection');
                
                resultFiles.innerHTML = '';
                
                files.forEach(file => {
                    const originalSize = file.originalSize ? (file.originalSize / 1024 / 1024).toFixed(2) : 'N/A';
                    const compressedSize = (file.blob.size / 1024 / 1024).toFixed(2);
                    const compressionRatio = file.originalSize ? 
                        ((1 - file.blob.size / file.originalSize) * 100).toFixed(1) : 0;
                    
                    let sizeInfo = '';
                    if (file.originalSize && file.blob.size !== file.originalSize) {
                        sizeInfo = `<span class="file-size-compression">(${originalSize}–ú–ë ‚Üí ${compressedSize}–ú–ë, -${compressionRatio}%)</span>`;
                    }
                    
                    const fileElement = document.createElement('div');
                    fileElement.className = 'result-file';
                    fileElement.innerHTML = `
                        <div>
                            <span>‚úÖ ${appState.escapeHtml(file.name)}</span>
                            ${sizeInfo}
                        </div>
                        <button class="download-btn" data-file="${appState.escapeHtml(file.name)}">
                            üì• –°–∫–∞—á–∞—Ç—å
                        </button>
                    `;
                    
                    fileElement.querySelector('button').addEventListener('click', () => {
                        appState.downloadSingleFile(file.name);
                    });
                    
                    resultFiles.appendChild(fileElement);
                });

                result.classList.remove('hidden');
                downloadSection.classList.remove('hidden');
            }

            static showSuccess(title, message) {
                this.showMessage('success', title, message);
            }

            static showError(message) {
                this.showMessage('error', '–û—à–∏–±–∫–∞', message);
            }

            static showMessage(type, title, message) {
                const oldMessages = document.querySelectorAll('.temp-message');
                oldMessages.forEach(msg => msg.remove());

                const messageDiv = document.createElement('div');
                messageDiv.className = `temp-message ${type}-message`;
                messageDiv.style.cssText = `
                    background: ${type === 'success' ? '#d4edda' : '#f8d7da'};
                    border: 2px solid ${type === 'success' ? '#27ae60' : '#e74c3c'};
                    border-radius: 8px;
                    padding: 15px;
                    margin: 15px 30px;
                    color: ${type === 'success' ? '#155724' : '#721c24'};
                `;
                messageDiv.innerHTML = `
                    <strong>${title}</strong><br>
                    ${message}
                `;

                const container = document.querySelector('.container');
                container.insertBefore(messageDiv, container.firstChild);

                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 5000);
            }
        }

        // ===============================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ===============================
        let appState;

        document.addEventListener('DOMContentLoaded', () => {
            appState = new AppState();
            
            window.addEventListener('beforeunload', () => {
                appState.uploadedFiles.forEach(file => {
                    if (file.objectURL) {
                        URL.revokeObjectURL(file.objectURL);
                    }
                    if (file.thumbnail && file.thumbnail.startsWith('blob:')) {
                        URL.revokeObjectURL(file.thumbnail);
                    }
                });
            });
        });
    </script>
</body>
</html>
